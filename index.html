<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Pediatric Pneumonia Detection</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/@tensorflow/tfjs@latest/dist/tf.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@teachablemachine/image@latest/dist/teachablemachine-image.min.js"></script>
</head>
<body class="bg-gradient-to-br from-purple-50 to-blue-50 min-h-screen">
    <div class="container mx-auto px-4 py-8 max-w-6xl">
          
        <header class="text-center mb-12">
            <div class="inline-block bg-gradient-to-r from-purple-600 to-blue-600 text-white px-8 py-4 rounded-2xl shadow-lg mb-4">
                <h1 class="text-4xl font-bold">Pediatric Pneumonia Detection</h1>
                <p class="text-purple-100 mt-2">AI-Powered Chest X-Ray Analysis</p>
            </div>
            
              
            <div class="mt-6 bg-yellow-50 border-l-4 border-yellow-400 p-4 rounded-lg max-w-3xl mx-auto">
                <div class="flex items-start">
                    <svg class="w-6 h-6 text-yellow-600 mr-3 flex-shrink-0 mt-0.5" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M8.257 3.099c.765-1.36 2.722-1.36 3.486 0l5.58 9.92c.75 1.334-.213 2.98-1.742 2.98H4.42c-1.53 0-2.493-1.646-1.743-2.98l5.58-9.92zM11 13a1 1 0 11-2 0 1 1 0 012 0zm-1-8a1 1 0 00-1 1v3a1 1 0 002 0V6a1 1 0 00-1-1z" clip-rule="evenodd"/>
                    </svg>
                    <div class="text-left">
                        <h3 class="text-yellow-800 font-semibold text-lg">Important: X-Ray Quality Requirements</h3>
                        <p class="text-yellow-700 mt-1">Please ensure the chest X-ray image is of <strong>high quality</strong>, properly exposed, and contains <strong>no annotations, markers, or text overlays</strong>. Poor quality images or those with markings may result in inaccurate predictions.</p>
                    </div>
                </div>
            </div>
        </header>

         
        <section class="bg-white rounded-2xl shadow-xl p-8 mb-8">
            <h2 class="text-2xl font-bold text-gray-800 mb-4 flex items-center">
                <svg class="w-7 h-7 mr-3 text-blue-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z"/>
                </svg>
                Upload Chest X-Ray
            </h2>
            
            <div class="border-3 border-dashed border-gray-300 rounded-xl p-8 text-center hover:border-purple-400 transition">
                <input type="file" id="imageUpload" accept="image/*" onchange="handleImageUpload(event)" class="hidden">
                <label for="imageUpload" class="cursor-pointer">
                    <svg class="w-16 h-16 mx-auto text-gray-400 mb-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M15 13l-3-3m0 0l-3 3m3-3v12"/>
                    </svg>
                    <span class="text-lg text-gray-600 font-medium">Click to upload X-ray image</span>
                    <p class="text-sm text-gray-500 mt-2">PNG, JPG, or JPEG (Image will be automatically resized)</p>
                </label>
            </div>

            <div id="imagePreview" class="mt-6 hidden">
                <img id="uploadedImage" class="max-w-md mx-auto rounded-lg shadow-lg border-4 border-purple-200">
                <button onclick="analyzeImage()" class="mt-6 bg-gradient-to-r from-green-500 to-teal-500 text-white px-8 py-3 rounded-lg font-semibold hover:from-green-600 hover:to-teal-600 transition shadow-lg block mx-auto">
                    Analyze X-Ray
                </button>
            </div>
        </section>

          
        <section id="resultsSection" class="bg-white rounded-2xl shadow-xl p-8 mb-8 hidden">
            <h2 class="text-2xl font-bold text-gray-800 mb-6 flex items-center">
                <svg class="w-7 h-7 mr-3 text-green-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z"/>
                </svg>
                Analysis Results
            </h2>
            <div id="predictions" class="space-y-4"></div>
            <div class="mt-6 p-4 bg-blue-50 rounded-lg border-l-4 border-blue-500">
                <p class="text-sm text-blue-800"><strong>Disclaimer:</strong> This is an AI-assisted tool and should not replace professional medical diagnosis. Please consult a qualified healthcare provider for accurate diagnosis and treatment.</p>
            </div>
        </section>

          
        <section class="bg-white rounded-2xl shadow-xl p-8 mb-8">
            <h2 class="text-2xl font-bold text-gray-800 mb-4 flex items-center">
                <svg class="w-7 h-7 mr-3 text-red-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"/>
                </svg>
                About Pediatric Pneumonia
            </h2>
            <div class="prose max-w-none text-gray-700 space-y-4">
                <p class="leading-relaxed">
                    <strong>Pneumonia</strong> is an infection that inflames the air sacs in one or both lungs. In children, it can be particularly serious and is one of the leading causes of childhood mortality worldwide. The air sacs may fill with fluid or pus, causing symptoms that can range from mild to severe.
                </p>
                
                <h3 class="text-xl font-semibold text-gray-800 mt-6 mb-3">Common Symptoms in Children:</h3>
                <ul class="list-disc list-inside space-y-2 ml-4">
                    <li>Persistent cough with phlegm</li>
                    <li>Fever, sweating, and chills</li>
                    <li>Rapid or difficult breathing</li>
                    <li>Chest pain when breathing or coughing</li>
                    <li>Loss of appetite and fatigue</li>
                    <li>Bluish lips or nails (in severe cases)</li>
                </ul>

                <h3 class="text-xl font-semibold text-gray-800 mt-6 mb-3">Effects and Complications:</h3>
                <ul class="list-disc list-inside space-y-2 ml-4">
                    <li><strong>Respiratory Distress:</strong> Difficulty breathing and low oxygen levels</li>
                    <li><strong>Pleural Effusion:</strong> Fluid accumulation around the lungs</li>
                    <li><strong>Sepsis:</strong> Life-threatening infection spread throughout the body</li>
                    <li><strong>Long-term Impact:</strong> Potential lung damage if left untreated</li>
                    <li><strong>Hospitalization:</strong> Severe cases may require intensive care</li>
                </ul>

                <div class="mt-6 p-4 bg-red-50 rounded-lg border-l-4 border-red-500">
                    <p class="text-red-800 font-medium">⚠️ Seek immediate medical attention if your child shows signs of severe breathing difficulty, persistent high fever, or bluish discoloration of the skin.</p>
                </div>
            </div>
        </section>

         
        <section class="bg-white rounded-2xl shadow-xl p-8">
            <h2 class="text-2xl font-bold text-gray-800 mb-4 flex items-center">
                <svg class="w-7 h-7 mr-3 text-red-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 5a2 2 0 012-2h3.28a1 1 0 01.948.684l1.498 4.493a1 1 0 01-.502 1.21l-2.257 1.13a11.042 11.042 0 005.516 5.516l1.13-2.257a1 1 0 011.21-.502l4.493 1.498a1 1 0 01.684.949V19a2 2 0 01-2 2h-1C9.716 21 3 14.284 3 6V5z"/>
                </svg>
                Emergency Contacts
            </h2>
            
            <div class="space-y-4">
                <div class="relative">
                    <label class="block text-gray-700 font-medium mb-2">Search for your country</label>
                    <input 
                        type="text" 
                        id="countrySearch" 
                        placeholder="Type country name..." 
                        class="w-full px-4 py-3 border-2 border-gray-300 rounded-lg focus:border-purple-500 focus:outline-none transition"
                        oninput="filterCountries()"
                        onfocus="showCountryList()"
                    >
                    
                    
                    <div id="countryList" class="hidden absolute z-10 w-full mt-2 bg-white border-2 border-gray-300 rounded-lg shadow-lg max-h-64 overflow-y-auto">
                         Countries will be populated here 
                    </div>
                </div>
                
                  
                <div id="emergencyInfo" class="hidden mt-6 p-6 bg-gradient-to-r from-red-50 to-orange-50 rounded-lg border-2 border-red-200">
                    <div class="flex items-start">
                        <svg class="w-8 h-8 text-red-600 mr-4 flex-shrink-0" fill="currentColor" viewBox="0 0 20 20">
                            <path d="M2 3a1 1 0 011-1h2.153a1 1 0 01.986.836l.74 4.435a1 1 0 01-.54 1.06l-1.548.773a11.037 11.037 0 006.105 6.105l.774-1.548a1 1 0 011.059-.54l4.435.74a1 1 0 01.836.986V17a1 1 0 01-1 1h-2C7.82 18 2 12.18 2 5V3z"/>
                        </svg>
                        <div>
                            <h3 id="selectedCountry" class="text-xl font-bold text-gray-800 mb-2"></h3>
                            <p class="text-gray-700 mb-2">Emergency Number:</p>
                            <p id="emergencyNumber" class="text-3xl font-bold text-red-600"></p>
                        </div>
                    </div>
                </div>
            </div>
        </section>

                <footer class="text-center mt-12 text-gray-600">
            <p class="text-sm">© 2025 Pediatric Pneumonia Detection System | For Educational and Research Purposes</p>
            <p class="text-xs mt-2">Always consult with qualified healthcare professionals for medical advice</p>
        </footer>
    </div>

    <script>
        let model, maxPredictions;

        // Emergency contacts database
        const emergencyContacts = {
            "United States": "911",
            "United Kingdom": "999",
            "Canada": "911",
            "Australia": "000",
            "India": "112",
            "Germany": "112",
            "France": "112",
            "Italy": "112",
            "Spain": "112",
            "Japan": "119",
            "China": "120",
            "South Korea": "119",
            "Brazil": "192",
            "Mexico": "911",
            "Russia": "103",
            "South Africa": "10177",
            "Nigeria": "112",
            "Egypt": "123",
            "Pakistan": "115",
            "Bangladesh": "999",
            "Indonesia": "118",
            "Philippines": "911",
            "Vietnam": "115",
            "Thailand": "1669",
            "Malaysia": "999",
            "Singapore": "995",
            "New Zealand": "111",
            "Argentina": "107",
            "Chile": "131",
            "Colombia": "123",
            "Peru": "116",
            "Venezuela": "171",
            "Saudi Arabia": "997",
            "UAE": "998",
            "Turkey": "112",
            "Iran": "115",
            "Iraq": "122",
            "Israel": "101",
            "Poland": "112",
            "Ukraine": "103",
            "Netherlands": "112",
            "Belgium": "112",
            "Sweden": "112",
            "Norway": "113",
            "Denmark": "112",
            "Finland": "112",
            "Switzerland": "144",
            "Austria": "144",
            "Greece": "166",
            "Portugal": "112",
            "Czech Republic": "112",
            "Hungary": "112",
            "Romania": "112"
        };

        // <CHANGE> Load model automatically on page load from local files
        async function initModel() {
            try {
                const modelURL = './model.json';
                const metadataURL = './metadata.json';
                
                model = await tmImage.load(modelURL, metadataURL);
                maxPredictions = model.getTotalClasses();
                
                console.log('Model loaded successfully from local files');
            } catch (error) {
                console.error('Error loading model:', error);
                alert('Error loading AI model. Please ensure model.json, metadata.json, and weights.bin are in the same folder as this HTML file.');
            }
        }

        // <CHANGE> Initialize model when page loads
        window.addEventListener('load', initModel);

        function showCountryList() {
            const listDiv = document.getElementById('countryList');
            const searchInput = document.getElementById('countrySearch');
            
            if (searchInput.value.trim() === '') {
                listDiv.classList.add('hidden');
            } else {
                listDiv.classList.remove('hidden');
            }
        }

        function filterCountries() {
            const searchTerm = document.getElementById('countrySearch').value.toLowerCase();
            const listDiv = document.getElementById('countryList');
            
            if (searchTerm.trim() === '') {
                listDiv.classList.add('hidden');
                return;
            }
            
            const filteredCountries = Object.keys(emergencyContacts).filter(country => 
                country.toLowerCase().includes(searchTerm)
            );
            
            if (filteredCountries.length === 0) {
                listDiv.innerHTML = '<div class="p-4 text-gray-500 text-center">No countries found</div>';
                listDiv.classList.remove('hidden');
                return;
            }
            
            listDiv.innerHTML = filteredCountries.map(country => `
                <div class="p-3 hover:bg-purple-50 cursor-pointer border-b border-gray-200 transition" onclick="selectCountry('${country}')">
                    <span class="font-medium text-gray-800">${country}</span>
                </div>
            `).join('');
            
            listDiv.classList.remove('hidden');
        }

        function selectCountry(country) {
            const emergencyNumber = emergencyContacts[country];
            
            document.getElementById('selectedCountry').textContent = country;
            document.getElementById('emergencyNumber').textContent = emergencyNumber;
            document.getElementById('emergencyInfo').classList.remove('hidden');
            document.getElementById('countrySearch').value = country;
            document.getElementById('countryList').classList.add('hidden');
        }

        document.addEventListener('click', function(event) {
            const searchInput = document.getElementById('countrySearch');
            const listDiv = document.getElementById('countryList');
            
            if (!searchInput.contains(event.target) && !listDiv.contains(event.target)) {
                listDiv.classList.add('hidden');
            }
        });

        function handleImageUpload(event) {
            const file = event.target.files[0];
            if (!file) return;

            const reader = new FileReader();
            reader.onload = function(e) {
                const img = new Image();
                img.onload = function() {
                    // Resize image
                    const canvas = document.createElement('canvas');
                    const ctx = canvas.getContext('2d');
                    
                    const maxSize = 800;
                    let width = img.width;
                    let height = img.height;
                    
                    if (width > height) {
                        if (width > maxSize) {
                            height *= maxSize / width;
                            width = maxSize;
                        }
                    } else {
                        if (height > maxSize) {
                            width *= maxSize / height;
                            height = maxSize;
                        }
                    }
                    
                    canvas.width = width;
                    canvas.height = height;
                    ctx.drawImage(img, 0, 0, width, height);
                    
                    const resizedImage = canvas.toDataURL('image/jpeg', 0.9);
                    document.getElementById('uploadedImage').src = resizedImage;
                    document.getElementById('imagePreview').classList.remove('hidden');
                };
                img.src = e.target.result;
            };
            reader.readAsDataURL(file);
        }

        async function analyzeImage() {
            if (!model) {
                alert('AI model is still loading. Please wait a moment and try again.');
                return;
            }

            const image = document.getElementById('uploadedImage');
            const prediction = await model.predict(image);
            
            displayResults(prediction);
        }

        function displayResults(predictions) {
            const resultsSection = document.getElementById('resultsSection');
            const predictionsDiv = document.getElementById('predictions');
            
            resultsSection.classList.remove('hidden');
            
            const sortedPredictions = predictions.sort((a, b) => b.probability - a.probability);
            
            predictionsDiv.innerHTML = sortedPredictions.map(pred => {
                const percentage = (pred.probability * 100).toFixed(2);
                const barColor = pred.probability > 0.5 ? 'bg-red-500' : 'bg-blue-500';
                
                return `
                    <div class="space-y-2">
                        <div class="flex justify-between items-center">
                            <span class="font-semibold text-gray-800">${pred.className}</span>
                            <span class="text-lg font-bold ${pred.probability > 0.5 ? 'text-red-600' : 'text-blue-600'}">${percentage}%</span>
                        </div>
                        <div class="w-full bg-gray-200 rounded-full h-4 overflow-hidden">
                            <div class="${barColor} h-4 rounded-full transition-all duration-500" style="width: ${percentage}%"></div>
                        </div>
                    </div>
                `;
            }).join('');
            
            resultsSection.scrollIntoView({ behavior: 'smooth', block: 'nearest' });
        }
    </script>
</body>
</html>